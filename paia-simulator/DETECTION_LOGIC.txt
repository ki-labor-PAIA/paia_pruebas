    // DETECTAR SOLICITUD DE COMUNICACIÃ“N ENTRE AGENTES
    if (detectAgentCommunicationRequest(message)) {
      console.log('ğŸ” Detectada solicitud de comunicaciÃ³n entre agentes');
      
      // Buscar nodos de agente y conexiÃ³n
      const agentNodes = nodes.filter(n => n.type === 'actor');
      const connectionNodes = nodes.filter(n => n.type === 'connection' && n.data.isConnected);
      
      console.log('ğŸ“Š Agentes encontrados:', agentNodes.length);
      console.log('ğŸ”— Nodos de conexiÃ³n:', connectionNodes.length);
      
      if (agentNodes.length > 0 && connectionNodes.length > 0) {
        // Encontrar el agente activo en el chat
        const sourceAgent = agentNodes.find(a => a.id === activeChatAgent);
        
        if (!sourceAgent) {
          console.log('âŒ No se encontrÃ³ el agente fuente');
        } else {
          console.log('âœ… Agente fuente:', sourceAgent.data.label);
          
          // Buscar nodo de conexiÃ³n conectado a este agente mediante edges
          let connectedNode = null;
          for (const connectionNode of connectionNodes) {
            // Verificar si hay un edge entre el agente y el nodo de conexiÃ³n
            const hasEdge = edges.some(edge => 
              (edge.source === sourceAgent.id && edge.target === connectionNode.id) ||
              (edge.target === sourceAgent.id && edge.source === connectionNode.id)
            );
            
            if (hasEdge) {
              connectedNode = connectionNode;
              console.log('âœ… Nodo de conexiÃ³n encontrado:', connectedNode.id);
              break;
            }
          }
          
          if (connectedNode && connectedNode.data.targetAgentId) {
            console.log('ğŸ¯ Target Agent ID:', connectedNode.data.targetAgentId);
            console.log('ğŸ¯ Target Agent Name:', connectedNode.data.targetAgentName);
            
            // Buscar el agente objetivo o crear uno temporal
            let targetAgent = agentNodes.find(a => a.id === connectedNode.data.targetAgentId);
            
            // Si no encontramos el agente en los nodos (es remoto), creamos uno temporal
            if (!targetAgent && connectedNode.data.targetAgentName) {
              targetAgent = {
                id: connectedNode.data.targetAgentId,
                data: { label: connectedNode.data.targetAgentName }
              };
              console.log('ğŸ“ Creado agente temporal:', targetAgent.data.label);
            }
            
            if (targetAgent) {
              console.log('ğŸš€ Iniciando conversaciÃ³n entre agentes');
              // Iniciar conversaciÃ³n entre agentes
              startAgentConversation(sourceAgent, targetAgent, message);
              return; // Salir de la funciÃ³n sin procesar el mensaje normalmente
            } else {
              console.log('âŒ No se pudo crear/encontrar el agente objetivo');
            }
          } else {
            console.log('âŒ No se encontrÃ³ nodo de conexiÃ³n vÃ¡lido o no tiene targetAgentId');
          }
        }
      }
    }
